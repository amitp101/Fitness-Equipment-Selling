{% extends 'user/layout/master.html' %}
{% block main %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<!-- Basic -->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Site Metas -->
    <title>Fitness Equipment Selling</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Site Icons -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Site CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="css/responsive.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>





    <!-- Start Top Search -->
    <div class="top-search">
        <div class="container">
            <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-search"></i></span>
                <input type="text" class="form-control" placeholder="Search">
                <span class="input-group-addon close-search"><i class="fa fa-times"></i></span>
            </div>
        </div>
    </div>
    <!-- End Top Search -->

    <!-- Start All Title Box -->
    <div class="all-title-box">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <a href="/user/checkout">
                    <h2>Checkout</h2></a>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active">Checkout</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End All Title Box -->

    <!-- Start Cart  -->
    <div class="mt-5">

                </div>
                <div class="col-sm-6 col-lg-6 mb-3">
                    <div class="row">

                        <div class="col-md-12 col-lg-12">
                            <div class="odr-box">
                                <div class="title-left">
                                    <h3>Shopping cart</h3>
                                </div>
                                <div class="rounded p-2 bg-light">
                                {% for i in all_cart %}
                                    <div class="media mb-2 border-bottom">
                                        <div class="media-body"> <a href="detail.html">{{i.p_id.p_name}}</a>
                                            <div class="small text-muted">{{i.p_id.p_price}}<span class="mx-2">|</span> Qty: {{ i.quantity }} <span class="mx-2">|</span> Subtotal: {{ i.order_price }}</div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 col-lg-12">
                            <div class="order-box">
                                <div class="title-left">
                                    <h3>Your order</h3>
                                </div>
                                <div class="d-flex">
                                    <div class="font-weight-bold">Charge</div>
                                    <div class="ml-auto font-weight-bold">Total</div>
                                </div>
                                <hr class="my-1">
                                {% for p in all_cart %}
                                    <div class="d-flex">
                                    <h4>{{ p.p_id.p_name }}</h4>
                                    <div class="ml-auto font-weight-bold"> {{p.order_price}} </div>
                                </div>
                                <hr class="my-1">
                                {% endfor %}
                                <div class="d-flex gr-total">
                                    <h5>Grand Total</h5>
                                    <div class="ml-auto h5">  {{amount}} </div>
                                </div>
                                <hr> </div>
                        </div>

                       {% if payment %}
                           <form class="text-center border border-light p-5" action="{% url 'confirm'%}"
              method="POST">
                        <button id="rzp-button1">Pay</button>
                        <script src="https://checkout.razorpay.com/v1/checkout.js">
                        </script>
                        <script>
                        var options = {
                        "key": "rzp_test_sICiDAziTKEuG2",
                        "amount": "{{payment.amount}}",
                        "currency": "INR",
                        "name": "Fitness Equipement & selling",
                        "description": "Test Transaction",
                        "image": "https://example.com/your_logo",
                        "order_id": "{{payment.id}}",

                        "handler": function (response){
                        payment_id = response.razorpay_payment_id;
                        order_id = response.razorpay_order_id;
                        signature = response.razorpay_signature;
                        mydata = {payment_id:payment_id, order_id:order_id, signature:signature}
                         $.ajax({
                                url: "/user/payment_store",
                                method:'GET',
                                data:mydata,
                                success: function(data){
                                    console.log(data)
                                    console.log(data.status)
                                    if(data.status == 'Save')
                                    {
                                        alert("Successfully");
                                    }
                                },
                            })
                    },
                        "prefill": {"name": "Gaurav Kumar",
                        "email": "abc@example.com",
                        "contact": ""},
                        "notes": {"address": "Razorpay Corporate Office"},
                        "theme": {"color": "#3399cc"}};

                        var rzp1 = new Razorpay(options);rzp1.on('payment.failed', function (response){
                        alert(response.error.code);
                        alert(response.error.description);
                        alert(response.error.source);
                        alert(response.error.step);
                        alert(response.error.reason);
                        alert(response.error.metadata.order_id);
                        alert(response.error.metadata.payment_id);});
                        document.getElementById('rzp-button1').onclick = function(e){
                        rzp1.open();
                        e.preventDefault();}</script>




</form>
                       {% else %}
                        <div class="col-12 d-flex shopping-box"> <a href="/user/payment" class="ml-auto btn hvr-hover">Place Order</a> </div>
                        {% endif %}

                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- End Cart -->






    <a href="#" id="back-to-top" title="Back to top" style="display: none;">&uarr;</a>

    <!-- ALL JS FILES -->
    <script src="{% static 'js/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- ALL PLUGINS -->
    <script src="{% static 'js/jquery.superslides.min.js' %}"></script>
    <script src="{% static 'js/bootstrap-select.js' %}"></script>
    <script src="{% static 'js/inewsticker.js' %}"></script>
    <script src="{% static 'js/bootsnav.js.' %}"></script>
    <script src="{% static 'js/images-loded.min.js' %}"></script>
    <script src="{% static 'js/isotope.min.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/baguetteBox.min.js' %}"></script>
    <script src="{% static 'js/form-validator.min.js' %}"></script>
    <script src="{% static 'js/contact-form-script.js' %}"></script>
    <script src="{% static 'js/custom.js"></script>
</body>

</html>
{% endblock %}